{% extends 'base.html' %}

{% block title%}Application Tracker{% endblock %}

{% block header%}
    <li class="nav-item">
        <a class="nav-link" href="{{ url_for('add_record') }}">Add record</a>
    </li>
{% endblock %}

{% block content%}
    <a class="btn btn-primary" href="{{ url_for('add_record') }}">Add record</a>

    <table class="table table-striped table-hover" id="tableAppInfo">
        <thead>
            <th scope="col">Company</th>
            <th scope="col">Position/Program</th>
            <th scope="col">Hiring Status</th>
            <th scope="col">Deadline</th>
            <th scope="col">Company Type</th>
            <th scope="col">Priority</th>
            <th scope="col">Application Portal</th>
            <th scope="col">Status</th>
            <th scope="col">Comment</th>
        </thead>
        {% for row in rows %}
        <tr>
            <td>{{row["company"]}}</td>
            <td><a href="{{ row['weblink'] }}" target="_blank">{{row["position"]}}</a></td>
            <td>{{row["posting_status"]}}</td>
            <td>{{row["deadline"]}}</td>
            <td>{{row["company_type"]}}</td>
            <td>{{row["app_priority"]}}</td>
            <td>{% if row['app_portal'] %}<a href="{{row['app_portal']}}" target="_blank">Link</a>{% endif %}</td>
            <td class="tdStatus">{{row["app_status"]}}</td>
            <td>{{row['note']}}</td>	
        </tr>
        {% endfor %}
    </table>
    <div class="hidden" hidden>
        <select class="form-select update-status" name="status">
            <option value="None"></option>
            <option value="Ready">Ready</option>
            <option value="Ongoing">Ongoing</option>
            <option value="Submitted">Submitted</option>
            <option value="Interview">Interview</option>
            <option value="Rejected">Rejected</option>
            <option value="Offer">Offer</option>
        </select>          
    </div>
    <script>
        $(document).ready(function(){
            $(document).click(function(){
                let sel_box = $('.tdStatus').find('select');
                let td_to_revert = sel_box.parent();
                td_to_revert.html(sel_box.val());
            })
            $('.tdStatus').click(function(){
                event.stopPropagation();
            })
            $('.tdStatus').dblclick(function(){
                event.stopPropagation();
                if($(this).text() === "None") return;
                if($(this).children().length === 0){
                    let sel_box = $('div.hidden').clone();
                    let curr_val = $(this).text();
                    sel_box.children().children('option[value=' + curr_val + ']').attr("selected", "selected");
                    $(this).html(sel_box.html());
                    // $(this).find('option').click(function(){
                    //     console.log($(this));
                    // });
                    $(this).find('select').one('change', function(){
                        curr_val = $(this).val();
                        console.log(curr_val);
                        $.post('/', {status: curr_val});
                        $(this).parent().html(curr_val);
                    });
                }
            });
        });
    </script>
{% endblock %}
